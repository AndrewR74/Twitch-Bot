<html><head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>YouTube Player</title>
  
    
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="URI.js"></script>

<style>
	body {
		margin: 0;
		padding: 0;
	}
	
	iframe {
		width: 100% !important;
		height: 100% !important;
	}
	
	#btn {
		display: none;
	}
</style>

<script>

	/*
	YT.PlayerState.ENDED
	YT.PlayerState.PLAYING
	YT.PlayerState.PAUSED
	YT.PlayerState.BUFFERING
	YT.PlayerState.CUED
	*/

	const COMMAND_VIDEO_DOESNT_EXIST = 0;
	const COMMAND_VIDEO_STARTED = 1;
	const COMMAND_VIDEO_STOPPED = 3;
	const COMMAND_VIDEO_ENDED = 13;
	const COMMAND_VIDEO_INFO = 4;
	const COMMAND_PLAYLIST_DOESNT_EXIST = 5;
	const COMMAND_PLAYLIST_INFO = 6;

	const COMMAND_GET_PLAYLIST = 7;
	const COMMAND_GET_VIDEO_INFO = 8;
	const COMMAND_PLAY_VIDEO = 9;
	const COMMAND_STOP_VIDEO = 10;
	const COMMAND_SET_VIDEO_VOLUME = 11;
	
	const COMMAND_PLAYER_FAILED_TO_LOAD = 12;

	var player, _laststate = -1, _moduleId = null, _command = -1, _videoId = null, _startTime = null;

	function onYouTubeIframeAPIReady() 
	{
		var u = (new URI(document.url)).search(true);

		if(typeof(u.m) !== "undefined") {
			_moduleId = u.m;
		}

		if(typeof(u.c) !== "undefined") {
			_command = parseInt(u.c);
		} else {
			_command = COMMAND_PLAY_VIDEO;
		}

		if(typeof(u.v) !== "undefined") {
			_videoId = u.v;
		}

		if(typeof(u.t) !== "undefined") {
			_startTime = u.t;
		}

		player = new YT.Player('player', {
			height: '240',
			width: '360',
			events: {
				'onReady': onPlayerReady,
				'onStateChange': onPlayerStateChange
			}
		});
	}

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
      		
			switch(_command) {
				case COMMAND_PLAY_VIDEO:
					event.target.loadVideoById({'videoId': _videoId, 'startSeconds': _startTime});
				break;
				case COMMAND_GET_PLAYLIST:
				break;
				case COMMAND_GET_VIDEO_INFO:
				break;
				default:
				break;
			}
      }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      function onPlayerStateChange(event) {
	
		if(event.data == 5) {
			var vinfo = player.getVideoData();
			console.log(vinfo);
		}
		
		if(_laststate == 3 && event.data == -1)
			window.postMessage({ method: "YouTubeSerivce", ModuleId: _moduleId, Command: COMMAND_VIDEO_DOESNT_EXIST }, "*");
        else if(event.data == YT.PlayerState.ENDED)
            window.postMessage({ method: "YouTubeSerivce", ModuleId: _moduleId, Command: COMMAND_VIDEO_ENDED }, "*");
		else if(event.data == YT.PlayerState.PLAYING)
			window.postMessage({ method: "YouTubeSerivce", ModuleId: _moduleId, Command: COMMAND_VIDEO_STARTED, Argument: player.getVideoData() }, "*");
			
		_laststate = event.data;
      }
	  
	  
      function stopVideo() {
        player.stopVideo();
      }


$(function() {
	$("#btn").on("click", function(e) {
		$("#btn").text(player.getCurrentTime());
	});
});
</script>
  <script src="https://www.youtube.com/iframe_api" async></script>

</head>
<body>

<div id="player"></div>
  
<div id="btn" style="width:50px;height:50px;background-color:red;"></div>

</body></html>